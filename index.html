<!DOCTYPE html>
<html>
<head>
    <title>–ú–∞–≥–∞–∑–∏–Ω –≤ Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1>–¢–µ—Å—Ç–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω</h1>
    <p>–¢–æ–≤–∞—Ä: –ö—Ä—É—Ç–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞ - 1500 —Ä—É–±.</p>
    
    <button onclick="sendOrder()">üì¶ –¢–µ—Å—Ç: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
    <button onclick="debugInfo()">üêõ Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>

    <div id="status" style="margin-top: 20px; padding: 10px; background: #f0f0f0;"></div>

    <script>
        let tg = window.Telegram.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.expand();
        tg.ready();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        const user = tg.initDataUnsafe?.user;
        if (user) {
            document.getElementById('status').innerHTML = 
                `üëã –ü—Ä–∏–≤–µ—Ç, ${user.first_name}! ID: ${user.id}`;
        }

        function debugInfo() {
            const status = document.getElementById('status');
            status.innerHTML = `
                <strong>Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
                - Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω: ${!!tg}<br>
                - User: ${user ? user.first_name + ' (ID: ' + user.id + ')' : '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}<br>
                - Bot –¥–æ—Å—Ç—É–ø–µ–Ω: ${!!tg.sendData}<br>
                - initData: ${JSON.stringify(tg.initDataUnsafe, null, 2)}
            `;
        }

        function sendOrder() {
            const orderData = {
                action: "buy",
                product: "–ö—Ä—É—Ç–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞",
                price: 1500,
                quantity: 1,
                user_id: user?.id || "unknown",
                username: user?.username || "no_username",
                first_name: user?.first_name || "unknown",
                comment: "–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ –∏–∑ Mini App",
                timestamp: new Date().toISOString(),
                source: "mini_app"
            };

            document.getElementById('status').innerHTML = 
                "üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –¥–∞–Ω–Ω—ã–µ: " + JSON.stringify(orderData, null, 2);

            console.log("–û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:", orderData);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
            try {
                tg.sendData(JSON.stringify(orderData));
                document.getElementById('status').innerHTML += 
                    "<br><span style='color: green;'>‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!</span>";
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º Mini App —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    tg.close();
                }, 2000);
                
            } catch (error) {
                document.getElementById('status').innerHTML += 
                    `<br><span style='color: red;'>‚ùå –û—à–∏–±–∫–∞: ${error}</span>`;
            }
        }
        
        // –ê–≤—Ç–æ-—Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
        // setTimeout(sendOrder, 1000);
    </script>
</body>
</html>