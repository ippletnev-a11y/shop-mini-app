<!DOCTYPE html>
<html>
<head>
    <title>–ú–∞–≥–∞–∑–∏–Ω –≤ Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 15px; margin: 10px; font-size: 16px; }
        #status { margin: 20px 0; padding: 15px; border-radius: 10px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üõçÔ∏è –¢–µ—Å—Ç–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω</h1>
    
    <div class="product-card">
        <h2>üëï –ö—Ä—É—Ç–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞</h2>
        <p><strong>–¶–µ–Ω–∞: 1500 —Ä—É–±.</strong></p>
        <button onclick="sendOrder()">üì¶ –ö—É–ø–∏—Ç—å —Å–µ–π—á–∞—Å</button>
    </div>

    <button onclick="sendDirectOrder()">üéØ –¢–µ—Å—Ç: –ü—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞</button>
    <button onclick="showDebug()">üêõ –ü–æ–∫–∞–∑–∞—Ç—å Debug</button>

    <div id="status" class="info"></div>

    <script>
        let tg = window.Telegram.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.expand();
        tg.ready();
        
        const user = tg.initDataUnsafe?.user;
        showDebug(); // –ü–æ–∫–∞–∑–∞—Ç—å debug –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

        function showDebug() {
            const status = document.getElementById('status');
            status.className = 'info';
            status.innerHTML = `
                <strong>Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
                - User: ${user ? user.first_name + ' (ID: ' + user.id + ')' : '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}<br>
                - WebApp –≥–æ—Ç–æ–≤: ${tg.isReady}<br>
                - Platform: ${tg.platform}<br>
                - Version: ${tg.version}
            `;
        }

        function sendOrder() {
            const orderData = {
                action: "buy",
                product: "–ö—Ä—É—Ç–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞",
                price: 1500,
                quantity: 1,
                user_id: user?.id,
                username: user?.username,
                first_name: user?.first_name,
                comment: "–ó–∞–∫–∞–∑ –∏–∑ Mini App",
                timestamp: new Date().toISOString(),
                source: "mini_app"
            };

            updateStatus("üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –¥–∞–Ω–Ω—ã–µ...", "info");
            console.log("–û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:", orderData);
            
            try {
                // –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –æ—Ç–ø—Ä–∞–≤–∫–∏
                tg.sendData(JSON.stringify(orderData));
                updateStatus("‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ tg.sendData()", "success");
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º Mini App —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    tg.close();
                }, 3000);
                
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error}`, "error");
            }
        }

        function sendDirectOrder() {
            const orderData = {
                action: "buy",
                product: "–ü—Ä—è–º–æ–π –∑–∞–∫–∞–∑",
                price: 2000,
                quantity: 2,
                user_id: user?.id,
                username: user?.username,
                comment: "–ü—Ä—è–º–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑",
                timestamp: new Date().toISOString(),
                test: "direct"
            };

            updateStatus("üéØ –ü—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞...", "info");
            
            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± - –∏–º–∏—Ç–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è
            const dataString = JSON.stringify(orderData);
            
            try {
                tg.sendData(dataString);
                updateStatus("‚úÖ –ü—Ä—è–º—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!", "success");
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä—è–º–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error}`, "error");
            }
        }

        function updateStatus(message, type) {
            const status = document.getElementById('status');
            status.className = type;
            status.innerHTML = message;
            console.log("Status:", message);
        }
    </script>
</body>
</html>