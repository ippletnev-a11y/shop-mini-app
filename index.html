<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini Shop — Свечи</title>
  <style>
    body { font-family: Arial, sans-serif; margin:16px; background:#f7f7f8; }
    h1 { font-size:20px; }
    .product { background:#fff; border-radius:10px; padding:12px; margin-bottom:12px; box-shadow:0 4px 8px rgba(0,0,0,0.1); }
    .buy-btn { padding:8px 12px; background:#0066cc; color:#fff; border:none; border-radius:6px; cursor:pointer; }
    input[type="number"], input[type="text"] { width:100%; padding:6px; margin-top:4px; margin-bottom:8px; border-radius:6px; border:1px solid #ccc; }
  </style>
</head>
<body>
<h1>Магазин свеч</h1>

<div class="product" data-name="Свеча Shield of Egypt" data-price="600">
  <b>Свеча Shield of Egypt</b> — 600 ₽<br>
  Количество: <input type="number" class="qty" value="1" min="1"><br>
  Комментарий: <input type="text" class="comment" placeholder="Опционально"><br>
  <button class="buy-btn">Купить</button>
</div>

<div class="product" data-name="Свеча Lotus Glow" data-price="450">
  <b>Свеча Lotus Glow</b> — 450 ₽<br>
  Количество: <input type="number" class="qty" value="1" min="1"><br>
  Комментарий: <input type="text" class="comment" placeholder="Опционально"><br>
  <button class="buy-btn">Купить</button>
</div>

<div class="product" data-name="Свеча Amber Night" data-price="700">
  <b>Свеча Amber Night</b> — 700 ₽<br>
  Количество: <input type="number" class="qty" value="1" min="1"><br>
  Комментарий: <input type="text" class="comment" placeholder="Опционально"><br>
  <button class="buy-btn">Купить</button>
</div>

<script>
const tg = window.Telegram?.WebApp;

document.querySelectorAll('.buy-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const card = btn.closest('.product');
    const orderData = {
      action: 'buy',
      product: card.dataset.name,
      price: parseInt(card.dataset.price),
      quantity: parseInt(card.querySelector('.qty').value),
      comment: card.querySelector('.comment').value || '',
      user_id: tg?.initDataUnsafe?.user?.id ?? null,
      username: tg?.initDataUnsafe?.user?.username ?? null
    };

    if (tg && tg.sendData) {
      tg.sendData(JSON.stringify(orderData));
      btn.textContent = "Отправлено ✓";
      btn.disabled = true;
      setTimeout(() => { btn.textContent = "Купить"; btn.disabled = false; }, 1500);
    } else {
      alert("Тестовый режим:\n" + JSON.stringify(orderData, null, 2));
    }
  });
});
</script>
</body>
</html>
